{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash

# ==============================================
# macOS Defaults for Developers
# ==============================================

# è¿™ä¸€è¡Œæ˜¯å“ˆå¸Œæ ¡éªŒï¼šåªæœ‰å½“ä½ ä¿®æ”¹äº†è¿™ä¸ªæ–‡ä»¶ï¼ŒChezmoi æ‰ä¼šé‡æ–°è¿è¡Œè¿™äº›å‘½ä»¤
# hash: {{ include (joinPath .chezmoi.sourceDir "run_onchange_darwin-defaults.sh.tmpl") | sha256sum }}

echo "ðŸ”§ Setting macOS defaults..."

# Close any open System Preferences panes, to prevent them from overriding settings weâ€™re about to change
osascript -e 'tell application "System Preferences" to quit'

# ------------------------------------------------------------------------------
# 1. é”®ç›˜ä¸Žè¾“å…¥ (æå‡ä»£ç è¾“å…¥æ•ˆçŽ‡)
# ------------------------------------------------------------------------------

# æŒ‰é”®é‡å¤é€Ÿåº¦ï¼šè®¾ç½®åˆ°æœ€å¿« (æ™®é€šè®¾ç½®é‡Œæ‹–ä¸åˆ°è¿™ä¹ˆå¿«)
# è¿™å¯¹ Vim/ç§»åŠ¨å…‰æ ‡éžå¸¸é‡è¦
defaults write NSGlobalDomain KeyRepeat -int 1
defaults write NSGlobalDomain InitialKeyRepeat -int 10

# ç¦ç”¨è‡ªåŠ¨æ›´æ­£ (å†™ä»£ç æ—¶ä¸éœ€è¦å®ƒè‡ªä½œèªæ˜Ž)
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false

# ------------------------------------------------------------------------------
# 2. Finder (æ–‡ä»¶ç®¡ç†)
# ------------------------------------------------------------------------------

# æ€»æ˜¯æ˜¾ç¤ºæ–‡ä»¶æ‰©å±•å (åŽç«¯å¼€å‘å¿…é¡»ï¼Œåˆ†æ¸… .ts å’Œ .tsx)
defaults write NSGlobalDomain AppleShowAllExtensions -bool true

# æ€»æ˜¯æ˜¾ç¤ºéšè—æ–‡ä»¶ (å¯é€‰ï¼Œå¦‚æžœä½ ç»å¸¸æ“ä½œ .git æˆ– .config ç›®å½•å»ºè®®å¼€å¯)
# defaults write com.apple.finder AppleShowAllFiles -bool true

# åœ¨æ ‡é¢˜æ æ˜¾ç¤ºå®Œæ•´è·¯å¾„
defaults write com.apple.finder _FXShowPosixPathInTitle -bool true

# é»˜è®¤æœç´¢èŒƒå›´ï¼šå½“å‰æ–‡ä»¶å¤¹ (è€Œä¸æ˜¯æœç´¢è¿™å° Mac)
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# ç¦ç”¨ .DS_Store åœ¨ç½‘ç»œç›˜(SMB/CIFS)ç”Ÿæˆ (ç‰¹åˆ«æ˜¯è¿žå…¬å¸ NAS æ—¶)
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# ------------------------------------------------------------------------------
# 3. Dock (æ¡Œé¢ç©ºé—´ä¼˜åŒ–)
# ------------------------------------------------------------------------------

# è‡ªåŠ¨éšè— Dock (å¢žåŠ å±å¹•çºµå‘ä»£ç é˜…è¯»ç©ºé—´)
defaults write com.apple.dock autohide -bool true

# ç§»é™¤è‡ªåŠ¨éšè—çš„åŠ¨ç”»å»¶è¿Ÿ (å…‰æ ‡ç¢°åˆ°è¾¹ç¼˜çž¬é—´æ˜¾ç¤ºï¼Œé›¶ç­‰å¾…)
defaults write com.apple.dock autohide-delay -float 0

# æœ€å°åŒ–æ•ˆæžœï¼šç¼©æ”¾ (Scale) æ¯” ç¥žå¥‡æ•ˆæžœ (Genie) æ›´å¿«ä¸”ä¸å ç”¨ CPU
defaults write com.apple.dock mineffect -string "scale"

# ------------------------------------------------------------------------------
# 4. å…¶ä»–ç»†èŠ‚
# ------------------------------------------------------------------------------

# æˆªå›¾é»˜è®¤ä¿å­˜ä¸º PNG (é«˜è´¨é‡)
defaults write com.apple.screencapture type -string "png"

# ç¦ç”¨â€œä½ ç¡®å®šè¦æ‰“å¼€è¿™ä¸ªåº”ç”¨å—ï¼Ÿâ€çš„éš”ç¦»æç¤º (è‡ªè¡Œæ–Ÿé…Œï¼Œå¯¹ä¸‹è½½çš„å·¥å…·å¾ˆæœ‰ç”¨)
# defaults write com.apple.LaunchServices LSQuarantine -bool false

# é¿å…åœ¨ç½‘ç»œå·ä¸Šåˆ›å»º .DS_Store æ–‡ä»¶
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true

# ------------------------------------------------------------------------------
# 5. é‡å¯ç›¸å…³æœåŠ¡è®©è®¾ç½®ç”Ÿæ•ˆ
# ------------------------------------------------------------------------------

echo "ðŸ”„ Restarting apps to apply changes..."
for app in "Dock" "Finder" "SystemUIServer"; do
    killall "${app}" > /dev/null 2>&1
done

echo "âœ… macOS settings applied!"

{{- end -}}
