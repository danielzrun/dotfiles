# =============================================================================
# Tmux Configuration
# =============================================================================

# General Settings
# -----------------------------------------------------------------------------

# Enable 256 colors and true color support
set -g default-terminal "screen-256color"
set-option -ga terminal-overrides ",xterm-256color:Tc"

# Enable mouse support
set -g mouse on

# Enable automatic renaming by default
# Programs can rename windows automatically
set -g allow-rename on
set -g automatic-rename on

# Start window and pane indexing from 1
set -g base-index 1
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g renumber-windows on

# Key Bindings
# -----------------------------------------------------------------------------

# Prefix key (Ctrl+a instead of Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Start new panes in current directory
bind c new-window -c "#{pane_current_path}"
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# Reload configuration file
bind r source-file {{ .chezmoi.homeDir }}/.config/tmux/tmux.conf \; display "Reloaded!"

# Toggle window name lock/unlock
# Use a window variable to track lock state
bind , run-shell ' \
  if [ "$(tmux show-window-options -v @window_locked 2>/dev/null)" = "1" ]; then \
    tmux set-window-option -u @window_locked \; set-window-option automatic-rename on \; set-window-option allow-rename on \; display-message "Window unlocked"; \
  else \
    tmux command-prompt -p "Lock Name:" "rename-window \"%%\" ; set-window-option @window_locked 1 ; set-window-option automatic-rename off ; set-window-option allow-rename off ; display-message \"Window locked\""; \
  fi'

# Plugins
# -----------------------------------------------------------------------------

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'

# UI Theme (Catppuccin)
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavour 'mocha'

# Plugin Configuration
# -----------------------------------------------------------------------------

# Catppuccin status bar configuration
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_window_status_style "basic"

# Window status text: show #T normally, #W when locked
set -g @catppuccin_window_text "#{?#{@window_locked},#W,#T}"
set -g @catppuccin_window_current_text "#{?#{@window_locked},#W,#T}"

set -g status-left ""
# Session module shows prefix status via color change (green -> red)
set -g status-right "#[fg=#{@thm_mauve}][#H] #{E:@catppuccin_status_session}"

# Initialize TPM (must be at the bottom)
# -----------------------------------------------------------------------------
run '{{ .chezmoi.homeDir }}/.config/tmux/plugins/tpm/tpm'
