{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
# =============================================================================
# Install Large GUI Applications
# =============================================================================
# This script runs when Brewfile.casks changes (via run_onchange_ prefix)
# Hash: {{ include "dot_config/brew/Brewfile.casks" | sha256sum }}
#
# These are separated from the main Brewfile to:
# - Speed up daily package syncing
# - Allow selective installation on new machines
# - Reduce bandwidth usage during automated syncs
# =============================================================================

CASKS_FILE="{{ .chezmoi.sourceDir }}/dot_config/brew/Brewfile.casks"

echo "üñ•Ô∏è  Syncing Large GUI Applications"
echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
echo ""
echo "This will sync from Brewfile.casks:"
echo "  ‚Ä¢ Ghostty (GPU-accelerated terminal)"
echo "  ‚Ä¢ Zed (Modern high-performance editor)"
echo "  ‚Ä¢ Snipaste (Screenshot & annotation tool)"
echo "  ‚Ä¢ Glance (Calendar & menu bar utility)"
echo "  ‚Ä¢ Hex Fiend (Fast hex editor)"
echo "  ‚Ä¢ Ghostscript (PostScript/PDF interpreter)"
echo ""
read -p "Continue? [y/N] " -n 1 -r
echo ""

if [[ $REPLY =~ ^[Yy]$ ]]; then
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    brew bundle --file="$CASKS_FILE" --verbose
    echo "‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ"
    echo ""

    # Remove quarantine attributes to prevent Gatekeeper warnings
    echo "üîì Removing quarantine attributes from installed applications..."

    APPS=(
        "/Applications/Ghostty.app"
        "/Applications/Zed.app"
        "/Applications/Snipaste.app"
        "/Applications/Glance.app"
        "/Applications/Hex Fiend.app"
    )

    for app in "${APPS[@]}"; do
        if [ -d "$app" ]; then
            xattr -dr com.apple.quarantine "$app" 2>/dev/null && \
                echo "  ‚úì Cleared: $(basename "$app")" || \
                echo "  ‚ÑπÔ∏è  Already clear: $(basename "$app")"
        fi
    done

    echo ""
    echo "‚úÖ Large applications synced!"
else
    echo "‚ùå Installation cancelled."
    echo ""
    echo "üí° To install later, run:"
    echo "   brew bundle --file=~/.config/brew/Brewfile.casks"
fi

{{- end -}}
