{{- if eq .chezmoi.os "darwin" -}}
#!/bin/bash
# =============================================================================
# macOS System Defaults for Development
# =============================================================================
# This script runs only once on first chezmoi apply

echo "ðŸ”§ Configuring macOS defaults..."

# Close System Preferences to prevent conflicts
osascript -e 'tell application "System Preferences" to quit'

# -----------------------------------------------------------------------------
# Keyboard & Input (optimize for coding)
# -----------------------------------------------------------------------------

# Fastest key repeat (crucial for Vim navigation)
defaults write NSGlobalDomain KeyRepeat -int 2
defaults write NSGlobalDomain InitialKeyRepeat -int 15

# Disable auto-correction (annoying when coding)
defaults write NSGlobalDomain NSAutomaticSpellingCorrectionEnabled -bool false
defaults write NSGlobalDomain NSAutomaticCapitalizationEnabled -bool false

# -----------------------------------------------------------------------------
# Finder
# -----------------------------------------------------------------------------

# Show full path in title bar
defaults write com.apple.finder _FXShowPosixPathInTitle -bool true

# Default search scope: current folder
defaults write com.apple.finder FXDefaultSearchScope -string "SCcf"

# Disable .DS_Store on network volumes
defaults write com.apple.desktopservices DSDontWriteNetworkStores -bool true
defaults write com.apple.desktopservices DSDontWriteUSBStores -bool true

# -----------------------------------------------------------------------------
# Dock (maximize screen real estate)
# -----------------------------------------------------------------------------

# Auto-hide Dock
defaults write com.apple.dock autohide -bool true

# Remove auto-hide delay (instant show)
defaults write com.apple.dock autohide-delay -float 0

# Minimize effect: scale (faster than genie)
defaults write com.apple.dock mineffect -string "scale"

# -----------------------------------------------------------------------------
# Screenshots
# -----------------------------------------------------------------------------

# Save as PNG (high quality)
defaults write com.apple.screencapture type -string "png"

# -----------------------------------------------------------------------------
# Apply Changes
# -----------------------------------------------------------------------------

echo "ðŸ”„ Restarting services..."
for app in "Dock" "Finder" "SystemUIServer"; do
    killall "${app}" > /dev/null 2>&1
done

echo "âœ… macOS defaults configured!"

{{- end -}}
